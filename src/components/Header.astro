---
// Header.astro - Barra de navegación estilo Ferxxo
import { Icon } from "astro-icon/components";
---

<header
  class="fixed top-0 left-0 w-full z-50 bg-ferxxo-black/80 backdrop-blur-md transition-colors duration-300 border-b border-ferxxo-pink/20"
>
  <div
    class="container mx-auto px-4 py-3 md:py-4 flex items-center justify-between"
  >
    <!-- Logo -->
    <a href="/" class="flex items-center group">
      <div
        class="w-10 h-10 md:w-12 md:h-12 relative overflow-hidden group-hover:animate-pulse"
      >
        <div
          class="absolute inset-0 bg-gradient-to-br from-ferxxo-pink via-ferxxo-purple to-ferxxo-blue rounded-lg blur-sm opacity-75 group-hover:opacity-100 transition-opacity duration-300"
        >
        </div>
        <div
          class="absolute inset-0.5 bg-ferxxo-black rounded-lg flex items-center justify-center z-10"
        >
          <svg
            width="24"
            height="24"
            viewBox="0 0 43 14"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            class="w-6 h-6 md:w-7 md:h-7"
          >
            <rect x="9" y="11" width="13" height="3" fill="currentColor"></rect>
            <rect x="9" width="3" height="14" fill="currentColor"></rect>
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M22 0C18.134 0 15 3.13401 15 7C15 10.866 18.134 14 22 14C24.748 14 27.1262 12.4165 28.2718 10.1122L25.6246 8.69408C24.9868 10.0564 23.6036 11 22 11C19.7909 11 18 9.20914 18 7C18 4.79086 19.7909 3 22 3C23.5773 3 24.9413 3.91288 25.5926 5.23911L28.5042 4.40723C27.4738 1.82482 24.95 0 22 0Z"
              fill="currentColor"></path>
            <path
              d="M30 14.0001L27 14.0001L33 6.1904e-05L36 6.26908e-05L30 14.0001Z"
              fill="currentColor"></path>
            <path
              d="M4.79998 6.67526e-05L8 6.16296e-05L3.2 7.00006L-1.08793e-06 7.00006L4.79998 6.67526e-05Z"
              fill="currentColor"></path>
            <path
              d="M4.79998 14.0001L8 14.0001L3.2 7.00006L6.79955e-07 7.00006L4.79998 14.0001Z"
              fill="currentColor"></path>
            <path
              d="M38.2 14.0001L35 14.0001L39.8 7.00006L43 7.00007L38.2 14.0001Z"
              fill="currentColor"></path>
            <path
              d="M38.2 6.43922e-05L35 5.76956e-05L39.8 7.00006L43 7.00006L38.2 6.43922e-05Z"
              fill="currentColor"></path>
          </svg>
        </div>
      </div>
      <div class="ml-2 md:ml-3 flex flex-col">
        <span
          class="text-lg md:text-xl font-bold text-ferxxo-pink tracking-wider"
        >
          Luis
        </span>
        <span class="text-[10px] md:text-xs text-ferxxo-blue tracking-wider"
          >Ccalluchi</span
        >
      </div>
    </a>

    <!-- Navegación para pantallas grandes -->
    <nav class="hidden md:flex items-center space-x-4 lg:space-x-8">
      <a
        href="#home"
        class="text-white hover:text-ferxxo-pink transition-colors tracking-wider font-medium text-sm lg:text-base"
        >INICIO</a
      >
      <!--  <a
        href="#about"
        class="text-white hover:text-ferxxo-pink transition-colors tracking-wider font-medium text-sm lg:text-base"
        >SOBRE MÍ</a
      > -->
      <a
        href="#projects"
        class="text-white hover:text-ferxxo-pink transition-colors tracking-wider font-medium text-sm lg:text-base"
        >PROYECTOS</a
      >
      <a
        href="#experience"
        class="text-white hover:text-ferxxo-pink transition-colors tracking-wider font-medium text-sm lg:text-base"
        >EXPERIENCIA</a
      >
      <a
        href="#certificates"
        class="text-white hover:text-ferxxo-pink transition-colors tracking-wider font-medium text-sm lg:text-base"
        >CERTIFICADOS</a
      >
      <!--   <a href="#contact" class="relative group overflow-hidden">
        <span
          class="absolute inset-0 bg-gradient-to-r from-ferxxo-pink to-ferxxo-purple opacity-0 group-hover:opacity-100 transition-opacity duration-300 blur-md"
        ></span>
        <span
          class="relative px-4 lg:px-6 py-2 inline-block bg-ferxxo-black border border-ferxxo-pink text-ferxxo-pink font-bold uppercase tracking-wider text-sm lg:text-base group-hover:text-white transition-colors duration-300"
        >
          Contacto
        </span>
      </a> -->
    </nav>

    <!-- Botón hamburguesa para móviles -->
    <button
      id="menuToggle"
      class="md:hidden flex items-center justify-center w-10 h-10 focus:outline-none border border-ferxxo-pink/30 rounded-lg p-2 touch-target"
      aria-label="Menú principal"
      aria-expanded="false"
    >
      <Icon name="mdi:menu" class="h-6 w-6 text-ferxxo-pink open-icon" />
      <Icon
        name="mdi:close"
        class="h-6 w-6 text-ferxxo-pink hidden close-icon"
      />
    </button>
  </div>

  <!-- Menú móvil -->
  <div
    id="mobileMenu"
    class="hidden md:hidden fixed top-[60px] left-0 w-full bg-ferxxo-black/95 shadow-lg py-4 px-6 transition-all duration-300 ease-in-out transform opacity-0 border-t border-ferxxo-pink/20 backdrop-blur-md"
    aria-hidden="true"
    style="z-index: 10000 !important;"
  >
    <div
      class="glitch-line absolute top-0 left-0 right-0 h-px bg-ferxxo-pink/30"
    >
    </div>

    <nav
      class="flex flex-col space-y-4 bg-black/80 rounded-lg border-2 border-ferxxo-pink/50 p-5 mobile-nav-glow"
    >
      <a
        href="#home"
        class="text-white hover:text-ferxxo-pink transition-colors py-3 tracking-wider font-bold uppercase touch-target relative mobile-nav-item text-lg"
        >Inicio</a
      >
      <!--   <a
        href="#about"
        class="text-white hover:text-ferxxo-pink transition-colors py-3 tracking-wider font-bold uppercase touch-target relative mobile-nav-item text-lg"
        >Sobre mí</a
      > -->
      <a
        href="#projects"
        class="text-white hover:text-ferxxo-pink transition-colors py-3 tracking-wider font-bold uppercase touch-target relative mobile-nav-item text-lg"
        >Proyectos</a
      >
      <a
        href="#experience"
        class="text-white hover:text-ferxxo-pink transition-colors py-3 tracking-wider font-bold uppercase touch-target relative mobile-nav-item text-lg"
        >Experiencia</a
      >
      <a
        href="#certificates"
        class="text-white hover:text-ferxxo-pink transition-colors py-3 tracking-wider font-bold uppercase touch-target relative mobile-nav-item text-lg"
        >Certificados</a
      >
      <!--   <a
        href="#contact"
        class="w-full bg-ferxxo-pink/20 border-2 border-ferxxo-pink py-3 my-2 text-white font-bold text-center uppercase tracking-wider hover:bg-ferxxo-pink/30 transition-colors touch-target relative mobile-nav-item text-lg"
      >
        Contacto
      </a> -->
    </nav>
  </div>
</header>

<style>
  .glitch-line {
    opacity: 0;
    animation: glitch-line 4s infinite;
  }

  @keyframes glitch-line {
    0% {
      opacity: 0;
      transform: translateX(-100%);
    }
    10%,
    30% {
      opacity: 0.5;
    }
    50% {
      opacity: 0.3;
      transform: translateX(0);
    }
    70%,
    90% {
      opacity: 0.5;
    }
    100% {
      opacity: 0;
      transform: translateX(100%);
    }
  }

  .mobile-nav-glow {
    box-shadow:
      0 0 20px rgba(255, 45, 158, 0.5),
      0 0 40px rgba(255, 45, 158, 0.3);
    animation: mobile-nav-pulse 4s infinite alternate;
  }

  .mobile-nav-item::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(
      to right,
      var(--ferxxo-pink),
      var(--ferxxo-blue)
    );
    transition: width 0.3s ease;
  }

  .mobile-nav-item:hover::after {
    width: 100%;
  }

  @keyframes mobile-nav-pulse {
    0% {
      box-shadow:
        0 0 20px rgba(255, 45, 158, 0.5),
        0 0 40px rgba(255, 45, 158, 0.3);
    }
    50% {
      box-shadow:
        0 0 20px rgba(0, 240, 255, 0.5),
        0 0 40px rgba(0, 240, 255, 0.3);
    }
    100% {
      box-shadow:
        0 0 20px rgba(255, 45, 158, 0.5),
        0 0 40px rgba(255, 45, 158, 0.3);
    }
  }

  /* Media query para mejorar accesibilidad en pantallas pequeñas */
  @media (max-width: 360px) {
    .container {
      padding-left: 0.5rem;
      padding-right: 0.5rem;
    }
  }

  /* Prevenimos scroll horizontal en dispositivos móviles */
  @media (max-width: 768px) {
    #mobileMenu {
      overflow-y: auto;
      max-height: calc(100vh - 70px);
      z-index: 10000 !important;
    }

    #mobileMenu.opacity-100 {
      display: block !important;
    }

    .mobile-nav-item {
      position: relative;
      overflow: hidden;
    }

    .mobile-nav-item::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 45, 158, 0.2),
        transparent
      );
      transition: left 0.5s;
    }

    .mobile-nav-item:hover::before {
      left: 100%;
    }
  }
</style>

<script>
  // Lógica para el menú móvil
  document.addEventListener("DOMContentLoaded", () => {
    const menuToggle = document.getElementById("menuToggle");
    const mobileMenu = document.getElementById("mobileMenu");
    const openIcon = document.querySelector(".open-icon");
    const closeIcon = document.querySelector(".close-icon");

    if (menuToggle && mobileMenu && openIcon && closeIcon) {
      // Función para abrir/cerrar el menú
      const toggleMenu = () => {
        const isExpanded = menuToggle?.getAttribute("aria-expanded") === "true";
        menuToggle?.setAttribute("aria-expanded", (!isExpanded).toString());
        mobileMenu.setAttribute("aria-hidden", isExpanded.toString());

        // Alternar la visibilidad del menú móvil
        if (isExpanded) {
          mobileMenu.classList.add("hidden");
          mobileMenu.classList.remove("opacity-100");
          mobileMenu.classList.add("opacity-0");
          openIcon.classList.remove("hidden");
          closeIcon.classList.add("hidden");
        } else {
          mobileMenu.classList.remove("hidden");
          // Forzar un reflow antes de añadir la opacidad para que la animación funcione
          void mobileMenu.offsetWidth;
          mobileMenu.classList.add("opacity-100");
          mobileMenu.classList.remove("opacity-0");
          openIcon.classList.add("hidden");
          closeIcon.classList.remove("hidden");
        }
      };

      // Event listener para el botón de menú
      menuToggle.addEventListener("click", toggleMenu);

      // Cerrar menú al hacer clic en un enlace
      const mobileLinks = mobileMenu.querySelectorAll("a");
      mobileLinks.forEach((link) => {
        link.addEventListener("click", () => {
          if (
            menuToggle?.getAttribute("aria-expanded") === "true" &&
            window.innerWidth < 768
          ) {
            toggleMenu();
          }
        });
      });

      // Cerrar menú al redimensionar ventana a desktop
      window.addEventListener("resize", () => {
        if (
          window.innerWidth >= 768 &&
          menuToggle?.getAttribute("aria-expanded") === "true"
        ) {
          toggleMenu();
        }
      });
    }
  });

  // Navegación suave
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    const handleClick = function (e: Event) {
      e.preventDefault();

      const link = e.currentTarget as HTMLAnchorElement;
      const targetId = link.getAttribute("href");
      if (targetId === "#") return;

      const targetElement = document.querySelector(targetId);
      if (targetElement) {
        // Usar scroll padding del CSS
        const scrollPadding = parseInt(
          getComputedStyle(document.documentElement).getPropertyValue(
            "--scroll-padding"
          ) || "80px"
        );

        window.scrollTo({
          top:
            targetElement.getBoundingClientRect().top +
            window.scrollY -
            scrollPadding,
          behavior: "smooth",
        });
      }
    };

    anchor.addEventListener("click", handleClick);
  });
</script>
